<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.14.0" xml:lang="en-US">
  <compounddef id="main_8c" kind="file" language="C++">
    <compoundname>main.c</compoundname>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">math.h</includes>
    <includes local="no">time.h</includes>
    <includes refid="config_8h" local="yes">config.h</includes>
    <includes refid="init__tool__module_8h" local="yes">init_tool_module.h</includes>
    <includes refid="io__utils_8h" local="yes">io_utils.h</includes>
    <includes refid="disk__model_8h" local="yes">disk_model.h</includes>
    <includes refid="dust__physics_8h" local="yes">dust_physics.h</includes>
    <includes refid="simulation__core_8h" local="yes">simulation_core.h</includes>
    <includes refid="utils_8h" local="yes">utils.h</includes>
    <includes refid="globals_8h" local="yes">globals.h</includes>
    <includes refid="simulation__types_8h" local="yes">simulation_types.h</includes>
    <includes refid="parser_8h" local="yes">parser.h</includes>
    <incdepgraph>
      <node id="6">
        <label>config.h</label>
        <link refid="config_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>/Users/tnehezd/Documents/Munka/dust_drift/src/main.c</label>
        <link refid="main_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>math.h</label>
      </node>
      <node id="7">
        <label>stdio.h</label>
      </node>
      <node id="2">
        <label>stdlib.h</label>
      </node>
      <node id="3">
        <label>string.h</label>
      </node>
      <node id="5">
        <label>time.h</label>
      </node>
    </incdepgraph>
    <sectiondef kind="func">
      <memberdef kind="function" id="main_8c_1aab2be44b551bed46bfd4e9d1820173b7" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void create_default_init_tool_options</definition>
        <argsstring>(init_tool_options_t *def)</argsstring>
        <name>create_default_init_tool_options</name>
        <param>
          <type>init_tool_options_t *</type>
          <declname>def</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/tnehezd/Documents/Munka/dust_drift/src/main.c" line="20" column="13" bodyfile="/Users/tnehezd/Documents/Munka/dust_drift/src/init_tool_module.c" bodystart="22" bodyend="53" declfile="/Users/tnehezd/Documents/Munka/dust_drift/src/main.c" declline="20" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="main_8c_1a217dbf8b442f20279ea00b898af96f52" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int main</definition>
        <argsstring>(int argc, const char **argv)</argsstring>
        <name>main</name>
        <param>
          <type>int</type>
          <declname>argc</declname>
        </param>
        <param>
          <type>const char **</type>
          <declname>argv</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/tnehezd/Documents/Munka/dust_drift/src/main.c" line="25" column="5" bodyfile="/Users/tnehezd/Documents/Munka/dust_drift/src/main.c" bodystart="25" bodyend="321"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;time.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Header<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="config_8h" kindref="compound">config.h</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Declarations<sp/>of<sp/>global<sp/>variables<sp/>and<sp/>constants</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;init_tool_module.h&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>run_init_tool<sp/>and<sp/>init_tool_options_t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;io_utils.h&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>from<sp/>io_utils.c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;disk_model.h&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>from<sp/>disk_model.c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;dust_physics.h&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>from<sp/>dust_physics.c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;simulation_core.h&quot;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>from<sp/>simulation_core.c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;utils.h&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>from<sp/>utils.h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;globals.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">//<sp/>NEW:<sp/>Include<sp/>your<sp/>simulation_types.h<sp/>and<sp/>parser.h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;simulation_types.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;parser.h&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>includes<sp/>function<sp/>declarations<sp/>for<sp/>parsing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Function<sp/>declaration<sp/>for<sp/>default<sp/>init_tool<sp/>options,<sp/>assuming<sp/>it&apos;s<sp/>in<sp/>init_tool_module.h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>create_default_init_tool_options(init_tool_options_t<sp/>*def);</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Global<sp/>variable<sp/>definition<sp/>for<sp/>PARTICLE_NUMBER<sp/>(if<sp/>not<sp/>defined<sp/>elsewhere)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Ensure<sp/>this<sp/>is<sp/>only<sp/>defined<sp/>in<sp/>ONE<sp/>.c<sp/>file,<sp/>and<sp/>declared<sp/>as<sp/>&apos;extern<sp/>int<sp/>PARTICLE_NUMBER;&apos;<sp/>in<sp/>config.h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>main(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>argc,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**argv)<sp/>{</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>DEBUG:<sp/>Program<sp/>start</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fprintf(stderr,<sp/>&quot;DEBUG<sp/>[main]:<sp/>Program<sp/>started.\n&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Declare<sp/>current_inputsig_file<sp/>here,<sp/>at<sp/>the<sp/>beginning<sp/>of<sp/>main<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>current_inputsig_file[MAX_PATH_LEN];</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>current_inputsig_file[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>to<sp/>empty<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Local<sp/>structure<sp/>to<sp/>store<sp/>command-line<sp/>options</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/>options_t<sp/>def;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/>create_default_options(&amp;def);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Local<sp/>structure<sp/>to<sp/>store<sp/>init_tool<sp/>parameters<sp/>(these<sp/>will<sp/>be<sp/>populated<sp/>from<sp/>&apos;def&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>init_tool_options_t<sp/>init_tool_params;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>create_default_init_tool_options(&amp;init_tool_params);</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Parse<sp/>command-line<sp/>options<sp/>and<sp/>populate<sp/>the<sp/>&apos;def&apos;<sp/>structure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>retCode<sp/>=<sp/>parse_options(argc,<sp/>argv,<sp/>&amp;def);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(0<sp/>!=<sp/>retCode)<sp/>{</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>parsing<sp/>command-line<sp/>options.<sp/>Exiting<sp/>with<sp/>code<sp/>%d.\n&quot;</highlight><highlight class="normal">,<sp/>retCode);</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>retCode;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Declare<sp/>instances<sp/>of<sp/>the<sp/>new<sp/>simulation<sp/>structs<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_t<sp/>disk_params;<sp/></highlight><highlight class="comment">//<sp/>Main<sp/>disk<sp/>parameters<sp/>struct</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>simulation_options_t<sp/>sim_opts;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files_t<sp/>output_files;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>output_files<sp/>pointers<sp/>to<sp/>NULL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.por_motion_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.micron_motion_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.mass_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.surface_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.dust_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.micron_dust_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>output_files.size_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Populate<sp/>the<sp/>simulation_options_t<sp/>struct<sp/>from<sp/>&apos;def&apos;<sp/>(parsed<sp/>options)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.evol<sp/>=<sp/>def.evol;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.drift<sp/>=<sp/>def.drift;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.growth<sp/>=<sp/>def.growth;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.twopop<sp/>=<sp/>def.twopop;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.DT<sp/>=<sp/>def.tStep;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.TMAX<sp/>=<sp/>def.totalTime;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.WO<sp/>=<sp/>def.outputFrequency;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.TCURR<sp/>=<sp/>def.startTime;<sp/></highlight><highlight class="comment">//<sp/>Initial<sp/>current<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.num_dust_particles<sp/>=<sp/>def.ndust_val;<sp/></highlight><highlight class="comment">//<sp/>NEW:<sp/>Populate<sp/>num_dust_particles<sp/>from<sp/>parsed<sp/>options</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>DEBUG:<sp/>Show<sp/>def.output_dir_name<sp/>BEFORE<sp/>it&apos;s<sp/>used<sp/>to<sp/>populate<sp/>sim_opts.output_dir_name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>def.output_dir_name<sp/>BEFORE<sp/>sim_opts<sp/>population:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>def.output_dir_name);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Evolution<sp/>(sim_opts.evol=%.2f)<sp/>or<sp/>drift<sp/>(sim_opts.drift=%.2f)<sp/>is<sp/>ON.<sp/>Starting<sp/>main<sp/>simulation<sp/>loop.\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.evol,<sp/>sim_opts.drift);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Populate<sp/>disk_t<sp/>with<sp/>parameters<sp/>from<sp/>&apos;def&apos;<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.RMIN<sp/>=<sp/>def.rmin_val;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.RMAX<sp/>=<sp/>def.rmax_val;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.NGRID<sp/>=<sp/>def.ngrid_val;<sp/></highlight><highlight class="comment">//<sp/>NGRID<sp/>(gas<sp/>grid<sp/>points)<sp/>is<sp/>from<sp/>parsed<sp/>options</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.SIGMA0<sp/>=<sp/>def.sigma0_val;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.SIGMAP_EXP<sp/>=<sp/>def.sigmap_exp_val;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.alpha_visc<sp/>=<sp/>def.alpha_visc_val;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.STAR_MASS<sp/>=<sp/>def.star_val;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.HASP<sp/>=<sp/>def.hasp_val;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.FLIND<sp/>=<sp/>def.flind_val;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.r_dze_i<sp/>=<sp/>def.r_dze_i_val;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.r_dze_o<sp/>=<sp/>def.r_dze_o_val;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.Dr_dze_i<sp/>=<sp/>def.dr_dze_i_val;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.Dr_dze_o<sp/>=<sp/>def.dr_dze_o_val;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.a_mod<sp/>=<sp/>def.a_mod_val;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.fFrag<sp/>=<sp/>def.ffrag;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.uFrag<sp/>=<sp/>def.ufrag;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.fDrift<sp/>=<sp/>0.55;<sp/></highlight><highlight class="comment">//<sp/>set<sp/>by<sp/>Birnstiel<sp/>2012</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>disk_params.PDENSITY<sp/>=<sp/>def.pdensity_val;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>sim_opts-&gt;dzone<sp/>based<sp/>on<sp/>dead<sp/>zone<sp/>radii<sp/>from<sp/>disk_params</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.dzone<sp/>=<sp/>(disk_params.r_dze_i<sp/>&gt;<sp/>0.0<sp/>||<sp/>disk_params.r_dze_o<sp/>&gt;<sp/>0.0)<sp/>?<sp/>1.0<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Output<sp/>directory<sp/>handling<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Mk_Dir<sp/>contains<sp/>the<sp/>numbering<sp/>logic<sp/>if<sp/>the<sp/>directory<sp/>already<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>Mk_Dir(def.output_dir_name);<sp/></highlight><highlight class="comment">//<sp/>Creates<sp/>the<sp/>main<sp/>output<sp/>folder,<sp/>potentially<sp/>with<sp/>a<sp/>number.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>After<sp/>Mk_Dir<sp/>(base<sp/>dir),<sp/>def.output_dir_name<sp/>is<sp/>now:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>def.output_dir_name);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>initial_dir_path[MAX_PATH_LEN];</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>logs_dir_path[MAX_PATH_LEN];</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>&apos;initial&apos;<sp/>subdirectory<sp/>using<sp/>CONFIG_DIR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>snprintf(initial_dir_path,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(initial_dir_path),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>def.output_dir_name,<sp/><ref refid="config_8c_1a5c64630e2efc107eaebce684662d0b32" kindref="member">CONFIG_DIR</ref>);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>Mk_Dir(initial_dir_path);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>&apos;LOGS&apos;<sp/>subdirectory<sp/>using<sp/>LOGS_DIR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>snprintf(logs_dir_path,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(logs_dir_path),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>def.output_dir_name,<sp/><ref refid="config_8c_1a5e24f7e18638f7c8bb96feda607d1403" kindref="member">LOGS_DIR</ref>);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>logs_dir_path<sp/>assembled<sp/>as:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>logs_dir_path);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>Mk_Dir(logs_dir_path);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CRITICAL:<sp/>Populate<sp/>sim_opts.output_dir_name<sp/>from<sp/>def.output_dir_name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(sim_opts.output_dir_name,<sp/>def.output_dir_name,<sp/>MAX_PATH_LEN<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.output_dir_name[MAX_PATH_LEN<sp/>-<sp/>1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>null-termination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>DEBUG:<sp/>Show<sp/>sim_opts.output_dir_name<sp/>immediately<sp/>after<sp/>population</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>sim_opts.output_dir_name<sp/>AFTER<sp/>population:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.output_dir_name);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;Output<sp/>subdirectories<sp/>created.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dummy_sys_ret;<sp/></highlight><highlight class="comment">//<sp/>Dummy<sp/>variable<sp/>for<sp/>system()<sp/>call<sp/>return<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cmd_buffer[MAX_PATH_LEN<sp/>*<sp/>2];<sp/></highlight><highlight class="comment">//<sp/>Buffer<sp/>for<sp/>system<sp/>commands</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Input<sp/>file<sp/>handling<sp/>logic<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>where<sp/>it&apos;s<sp/>decided<sp/>whether<sp/>to<sp/>read<sp/>from<sp/>a<sp/>file<sp/>or<sp/>generate<sp/>a<sp/>new<sp/>profile.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>It&apos;s<sp/>crucial<sp/>that<sp/>disk_params<sp/>members<sp/>are<sp/>allocated<sp/>memory<sp/>ONLY<sp/>ONCE.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(def.input_file<sp/>!=<sp/>NULL<sp/>&amp;&amp;<sp/>strcmp(def.input_file,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>an<sp/>input<sp/>file<sp/>is<sp/>specified:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strncpy(current_inputsig_file,<sp/>def.input_file,<sp/>MAX_PATH_LEN<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_inputsig_file[MAX_PATH_LEN<sp/>-<sp/>1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Input<sp/>file<sp/>specified:<sp/>&apos;%s&apos;.<sp/>Attempting<sp/>to<sp/>read<sp/>initial<sp/>profile.\n&quot;</highlight><highlight class="normal">,<sp/>current_inputsig_file);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>disk_params.NGRID<sp/>update<sp/>from<sp/>file<sp/>*before*<sp/>allocation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.NGRID<sp/>=<sp/>reszecskek_szama(current_inputsig_file);<sp/></highlight><highlight class="comment">//<sp/>Update<sp/>NGRID<sp/>from<sp/>file<sp/>(for<sp/>GAS<sp/>grid)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Recalculate<sp/>DD<sp/>based<sp/>on<sp/>the<sp/>updated<sp/>NGRID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.NGRID<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.DD<sp/>=<sp/>(disk_params.RMAX<sp/>-<sp/>disk_params.RMIN)<sp/>/<sp/>(disk_params.NGRID<sp/>-<sp/>1.0);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.DD<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>NGRID<sp/>set<sp/>from<sp/>input<sp/>file:<sp/>%d.<sp/>DD<sp/>calculated<sp/>as<sp/>%.4e.\n&quot;</highlight><highlight class="normal">,<sp/>disk_params.NGRID,<sp/>disk_params.DD);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Dynamic<sp/>Memory<sp/>Allocation<sp/>for<sp/>Disk<sp/>Arrays<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>happens<sp/>ONLY<sp/>HERE,<sp/>because<sp/>run_init_tool<sp/>is<sp/>not<sp/>called!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.rvec<sp/>=<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*)malloc((disk_params.NGRID<sp/>+<sp/>2)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.sigmavec<sp/>=<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*)malloc((disk_params.NGRID<sp/>+<sp/>2)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.pressvec<sp/>=<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*)malloc((disk_params.NGRID<sp/>+<sp/>2)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.dpressvec<sp/>=<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*)malloc((disk_params.NGRID<sp/>+<sp/>2)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.ugvec<sp/>=<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>*)malloc((disk_params.NGRID<sp/>+<sp/>2)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!disk_params.rvec<sp/>||<sp/>!disk_params.sigmavec<sp/>||<sp/>!disk_params.pressvec<sp/>||<sp/>!disk_params.dpressvec<sp/>||<sp/>!disk_params.ugvec)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>[main]:<sp/>Failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>disk<sp/>arrays<sp/>(input<sp/>file<sp/>branch).<sp/>Exiting.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Disk<sp/>profile<sp/>arrays<sp/>dynamically<sp/>allocated<sp/>with<sp/>size<sp/>NGRID+2<sp/>=<sp/>%d<sp/>(input<sp/>file<sp/>branch).\n&quot;</highlight><highlight class="normal">,<sp/>disk_params.NGRID<sp/>+<sp/>2);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>disk_param_be<sp/>because<sp/>run_init_tool<sp/>is<sp/>not<sp/>called</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Calling<sp/>disk_param_be<sp/>to<sp/>calculate<sp/>derived<sp/>disk<sp/>parameters<sp/>for<sp/>main<sp/>disk_params<sp/>struct<sp/>(input<sp/>file<sp/>branch).\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_param_be(&amp;disk_params);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>disk_param_be<sp/>completed<sp/>(input<sp/>file<sp/>branch).\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Copy<sp/>input<sp/>profile<sp/>file<sp/>to<sp/>the<sp/>&apos;initial&apos;<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(cmd_buffer,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cmd_buffer),<sp/></highlight><highlight class="stringliteral">&quot;cp<sp/>%s<sp/>%s/&quot;</highlight><highlight class="normal">,<sp/>current_inputsig_file,<sp/>initial_dir_path);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dummy_sys_ret<sp/>=<sp/>system(cmd_buffer);<sp/>(void)dummy_sys_ret;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Copied<sp/>initial<sp/>profile<sp/>file<sp/>&apos;%s&apos;<sp/>to<sp/>&apos;%s/&apos;.\n&quot;</highlight><highlight class="normal">,<sp/>current_inputsig_file,<sp/>initial_dir_path);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Copy<sp/>disk_config.dat<sp/>(FILENAME_DISK_PARAM)<sp/>file<sp/>to<sp/>the<sp/>&apos;initial&apos;<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(cmd_buffer,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cmd_buffer),<sp/></highlight><highlight class="stringliteral">&quot;cp<sp/>%s<sp/>%s/&quot;</highlight><highlight class="normal">,<sp/><ref refid="config_8c_1a82f593b4f143ee8046d46f666dadc43e" kindref="member">FILENAME_DISK_PARAM</ref>,<sp/>initial_dir_path);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dummy_sys_ret<sp/>=<sp/>system(cmd_buffer);<sp/>(void)dummy_sys_ret;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Copied<sp/>%s<sp/>to<sp/>%s/\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="config_8c_1a82f593b4f143ee8046d46f666dadc43e" kindref="member">FILENAME_DISK_PARAM</ref>,<sp/>initial_dir_path);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>NO<sp/>input<sp/>file<sp/>is<sp/>specified:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>No<sp/>input<sp/>file<sp/>specified<sp/>(-i<sp/>flag<sp/>not<sp/>used).<sp/>Generating<sp/>default<sp/>grid<sp/>and<sp/>profile.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Populate<sp/>init_tool_options_t<sp/>from<sp/>&apos;def&apos;<sp/>(command-line)<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.n_grid_points<sp/>=<sp/>disk_params.NGRID;<sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>the<sp/>gas<sp/>grid<sp/>resolution</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.r_inner=<sp/>disk_params.RMIN;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.r_outer<sp/>=<sp/>disk_params.RMAX;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.sigma0_gas_au<sp/>=<sp/>disk_params.SIGMA0;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.sigma_exponent<sp/>=<sp/>disk_params.SIGMAP_EXP;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.deadzone_r_inner<sp/>=<sp/>disk_params.r_dze_i;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.deadzone_r_outer<sp/>=<sp/>disk_params.r_dze_o;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.deadzone_dr_inner<sp/>=<sp/>disk_params.Dr_dze_i;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.deadzone_dr_outer<sp/>=<sp/>disk_params.Dr_dze_o;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.alpha_viscosity<sp/>=<sp/>disk_params.alpha_visc;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.deadzone_alpha_mod<sp/>=<sp/>disk_params.a_mod;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.aspect_ratio<sp/>=<sp/>disk_params.HASP;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.flaring_index<sp/>=<sp/>disk_params.FLIND;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.star_mass<sp/>=<sp/>disk_params.STAR_MASS;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.dust_to_gas_ratio<sp/>=<sp/>def.eps_val;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.n_dust_particles<sp/>=<sp/>def.ndust_val;<sp/></highlight><highlight class="comment">//<sp/>Uses<sp/>the<sp/>specific<sp/>dust<sp/>particle<sp/>count</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.two_pop_ratio<sp/>=<sp/>def.ratio_val;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.micro_size_cm<sp/>=<sp/>def.mic_val;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.one_size_particle_cm<sp/>=<sp/>def.onesize_val;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.dust_density_g_cm3<sp/>=<sp/>def.pdensity_val;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>init_tool_options_t<sp/>(init_tool_params)<sp/>structure<sp/>populated<sp/>for<sp/>profile<sp/>generation.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Generate<sp/>profile<sp/>directly<sp/>into<sp/>the<sp/>&apos;initial&apos;<sp/>directory<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Calling<sp/>run_init_tool(&amp;init_tool_params,<sp/>&amp;disk_params)...\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strncpy(init_tool_params.output_base_path,<sp/>initial_dir_path,<sp/>MAX_PATH_LEN<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init_tool_params.output_base_path[MAX_PATH_LEN<sp/>-<sp/>1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>run_init_tool<sp/>is<sp/>responsible<sp/>for<sp/>allocating<sp/>and<sp/>populating<sp/>disk_params<sp/>members</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>run_init_tool(&amp;init_tool_params,<sp/>&amp;disk_params);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>run_init_tool<sp/>completed.<sp/>disk_params<sp/>allocated<sp/>and<sp/>populated.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>current_inputsig_file<sp/>points<sp/>to<sp/>the<sp/>generated<sp/>file<sp/>in<sp/>initial_dir_path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CHANGE<sp/>HERE:<sp/>FILENAME_INIT_PROFILE<sp/>-&gt;<sp/>FILENAME_INIT_GAS_PROFILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(current_inputsig_file,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(current_inputsig_file),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>initial_dir_path,<sp/><ref refid="config_8c_1ac722ada7d8c0ac47d07acbee5c837fec" kindref="member">FILENAME_INIT_GAS_PROFILE</ref>);</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Generated<sp/>GAS<sp/>profile<sp/>will<sp/>be<sp/>loaded<sp/>from<sp/>&apos;%s&apos;.\n&quot;</highlight><highlight class="normal">,<sp/>current_inputsig_file);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Update<sp/>NGRID<sp/>from<sp/>the<sp/>generated<sp/>file<sp/>(critical<sp/>for<sp/>ReadSigmaFile<sp/>sizing)<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Important:<sp/>Here,<sp/>the<sp/>number<sp/>of<sp/>lines<sp/>should<sp/>be<sp/>read<sp/>from<sp/>FILENAME_INIT_GAS_PROFILE,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>provided<sp/>that<sp/>init_tool_module.c<sp/>creates<sp/>this<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.NGRID<sp/>=<sp/>reszecskek_szama(current_inputsig_file);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.NGRID<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.DD<sp/>=<sp/>(disk_params.RMAX<sp/>-<sp/>disk_params.RMIN)<sp/>/<sp/>(disk_params.NGRID<sp/>-<sp/>1.0);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>disk_params.DD<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>NGRID<sp/>updated<sp/>from<sp/>generated<sp/>file:<sp/>%d.<sp/>DD<sp/>calculated<sp/>as<sp/>%.4e.\n&quot;</highlight><highlight class="normal">,<sp/>disk_params.NGRID,<sp/>disk_params.DD);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>need<sp/>for<sp/>&apos;cp&apos;<sp/>here<sp/>for<sp/>FILENAME_DISK_PARAM<sp/>or<sp/>FILENAME_INIT_PROFILE,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>since<sp/>run_init_tool<sp/>created<sp/>them<sp/>directly<sp/>in<sp/>initial_dir_path.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>CRITICAL<sp/>STEP:<sp/>Now<sp/>that<sp/>current_inputsig_file<sp/>is<sp/>set,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>copy<sp/>it<sp/>to<sp/>sim_opts.input_filename<sp/>for<sp/>tIntegrate.<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>the<sp/>gas<sp/>profile<sp/>filename<sp/>that<sp/>ReadSigmaFile<sp/>reads.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(sim_opts.input_filename,<sp/>current_inputsig_file,<sp/>MAX_PATH_LEN<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.input_filename[MAX_PATH_LEN<sp/>-<sp/>1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>null-termination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>sim_opts.input_filename<sp/>set<sp/>to<sp/>&apos;%s&apos;<sp/>for<sp/>tIntegrate<sp/>(gas<sp/>profile).\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.input_filename);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>NEW<sp/>PART:<sp/>Set<sp/>the<sp/>dust<sp/>profile<sp/>filename<sp/>in<sp/>sim_opts.dust_input_filename<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>the<sp/>dust<sp/>profile<sp/>filename<sp/>that<sp/>ReadDustFile<sp/>reads<sp/>within<sp/>tIntegrate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>current_inputdust_file[MAX_PATH_LEN];</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>snprintf(current_inputdust_file,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(current_inputdust_file),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>initial_dir_path,<sp/><ref refid="config_8c_1af8a67542b5405e5db4fe01621488f529" kindref="member">FILENAME_INIT_DUST_PROFILE</ref>);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(sim_opts.dust_input_filename,<sp/>current_inputdust_file,<sp/>MAX_PATH_LEN<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>sim_opts.dust_input_filename[MAX_PATH_LEN<sp/>-<sp/>1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>null-termination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>sim_opts.dust_input_filename<sp/>set<sp/>to<sp/>&apos;%s&apos;<sp/>for<sp/>tIntegrate<sp/>(dust<sp/>profile).\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.dust_input_filename);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>CRITICAL<sp/>STEP:<sp/>Set<sp/>the<sp/>global<sp/>PARTICLE_NUMBER<sp/>based<sp/>on<sp/>the<sp/>actual<sp/>dust<sp/>particle<sp/>file.<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>ensures<sp/>PARTICLE_NUMBER<sp/>reflects<sp/>the<sp/>*dust*<sp/>particle<sp/>count,<sp/>not<sp/>the<sp/>gas<sp/>grid<sp/>count.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="config_8c_1ae28967b989638744a8c653fa8228c1b6" kindref="member">PARTICLE_NUMBER</ref><sp/>=<sp/>reszecskek_szama(sim_opts.dust_input_filename);<sp/></highlight><highlight class="comment">//<sp/>Read<sp/>lines<sp/>from<sp/>the<sp/>dust<sp/>profile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Global<sp/>PARTICLE_NUMBER<sp/>set<sp/>to<sp/>%d<sp/>(from<sp/>dust<sp/>input<sp/>file:<sp/>%s).\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="config_8c_1ae28967b989638744a8c653fa8228c1b6" kindref="member">PARTICLE_NUMBER</ref>,<sp/>sim_opts.dust_input_filename);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>disk_param_be<sp/>call<sp/>has<sp/>already<sp/>occurred<sp/>in<sp/>the<sp/>appropriate<sp/>branch<sp/>(if<sp/>using<sp/>input<sp/>file)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>was<sp/>called<sp/>by<sp/>run_init_tool<sp/>(if<sp/>generating).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Initial<sp/>profile<sp/>loading<sp/>for<sp/>ReadSigmaFile...\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/>ReadSigmaFile(&amp;disk_params,<sp/>current_inputsig_file);<sp/></highlight><highlight class="comment">//<sp/>This<sp/>populates<sp/>disk_params.sigmavec<sp/>and<sp/>rvec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>ReadSigmaFile<sp/>completed.<sp/>Calling<sp/>Perem<sp/>for<sp/>disk_params.rvec<sp/>and<sp/>disk_params.sigmavec...\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>Perem(disk_params.rvec,<sp/>&amp;disk_params);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>Perem(disk_params.sigmavec,<sp/>&amp;disk_params);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Perem<sp/>calls<sp/>completed<sp/>for<sp/>initial<sp/>profile.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Print<sp/>current<sp/>information</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Calling<sp/>infoCurrent...\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Here,<sp/>def.output_dir_name<sp/>is<sp/>passed,<sp/>which<sp/>already<sp/>contains<sp/>the<sp/>numbered<sp/>folder<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>infoCurrent(def.output_dir_name,<sp/>&amp;disk_params,<sp/>&amp;sim_opts);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>simulation<sp/>or<sp/>exit<sp/>based<sp/>on<sp/>options</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(sim_opts.evol<sp/>==<sp/>0.<sp/>&amp;&amp;<sp/>sim_opts.drift<sp/>==<sp/>0.)<sp/>{</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Evolution<sp/>(sim_opts.evol=%.2f)<sp/>and<sp/>drift<sp/>(sim_opts.drift=%.2f)<sp/>are<sp/>OFF.\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.evol,<sp/>sim_opts.drift);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>dens_name_initial[MAX_PATH_LEN];</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(dens_name_initial,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(dens_name_initial),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>initial_dir_path,<sp/><ref refid="config_8c_1ac722ada7d8c0ac47d07acbee5c837fec" kindref="member">FILENAME_INIT_GAS_PROFILE</ref>);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Printing<sp/>initial<sp/>surface<sp/>density<sp/>to<sp/>%s.\n&quot;</highlight><highlight class="normal">,<sp/>dens_name_initial);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Special<sp/>handling<sp/>for<sp/>Print_Sigma<sp/>when<sp/>only<sp/>initial<sp/>output<sp/>is<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_files_t<sp/>temp_output_for_initial_print;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp_output_for_initial_print.surface_file<sp/>=<sp/>fopen(dens_name_initial,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(temp_output_for_initial_print.surface_file<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>header<sp/>to<sp/>initial<sp/>surface<sp/>density<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(temp_output_for_initial_print.surface_file,<sp/></highlight><highlight class="stringliteral">&quot;#<sp/>Initial<sp/>Disk<sp/>Profile<sp/>Data<sp/>(Gas<sp/>Surface<sp/>Density,<sp/>Pressure,<sp/>Gradient)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(temp_output_for_initial_print.surface_file,<sp/></highlight><highlight class="stringliteral">&quot;#<sp/>Columns:<sp/>1.<sp/>Radius<sp/>[AU],<sp/>2.<sp/>Sigma_gas<sp/>[M_Sun/AU^2],\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(temp_output_for_initial_print.surface_file,<sp/></highlight><highlight class="stringliteral">&quot;#<sp/><sp/><sp/>3.<sp/>Pressure<sp/>[units],<sp/>4.<sp/>dP/dR<sp/>[units]\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(temp_output_for_initial_print.surface_file,<sp/></highlight><highlight class="stringliteral">&quot;#\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(temp_output_for_initial_print.surface_file,<sp/></highlight><highlight class="stringliteral">&quot;#<sp/>Data<sp/>generated<sp/>by<sp/>Dust<sp/>Drift<sp/>Simulation<sp/>(Initial<sp/>State)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fflush(temp_output_for_initial_print.surface_file);</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Print_Sigma(&amp;disk_params,<sp/>&amp;temp_output_for_initial_print);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fclose(temp_output_for_initial_print.surface_file);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp_output_for_initial_print.surface_file<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Closed<sp/>%s.\n&quot;</highlight><highlight class="normal">,<sp/>dens_name_initial);</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>[main]:<sp/>Could<sp/>not<sp/>open<sp/>%s<sp/>for<sp/>initial<sp/>surface<sp/>output.\n&quot;</highlight><highlight class="normal">,<sp/>dens_name_initial);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Print_Sigma<sp/>completed.<sp/>Program<sp/>exiting.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Evolution<sp/>(sim_opts.evol=%.2f)<sp/>or<sp/>drift<sp/>(sim_opts.drift=%.2f)<sp/>is<sp/>ON.<sp/>Starting<sp/>main<sp/>simulation<sp/>loop.\n&quot;</highlight><highlight class="normal">,<sp/>sim_opts.evol,<sp/>sim_opts.drift);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Calling<sp/>tIntegrate...\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pass<sp/>sim_opts<sp/>to<sp/>tIntegrate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tIntegrate<sp/>must<sp/>ensure<sp/>to<sp/>use<sp/>the<sp/>correct<sp/>(numbered)<sp/>output_dir_name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tIntegrate(&amp;disk_params,<sp/>&amp;sim_opts,<sp/>&amp;output_files);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>tIntegrate<sp/>completed.<sp/>Program<sp/>finished<sp/>normally.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Free<sp/>dynamically<sp/>allocated<sp/>memory<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Free<sp/>the<sp/>memory<sp/>allocated<sp/>for<sp/>disk_params.rvec,<sp/>sigmavec,<sp/>etc.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>allocation<sp/>happened<sp/>in<sp/>the<sp/>&apos;if&apos;<sp/>branch<sp/>if<sp/>an<sp/>input<sp/>file<sp/>was<sp/>used,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>within<sp/>run_init_tool<sp/>in<sp/>the<sp/>&apos;else&apos;<sp/>branch.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.rvec)<sp/>free(disk_params.rvec);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.sigmavec)<sp/>free(disk_params.sigmavec);</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.pressvec)<sp/>free(disk_params.pressvec);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.dpressvec)<sp/>free(disk_params.dpressvec);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(disk_params.ugvec)<sp/>free(disk_params.ugvec);</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Dynamically<sp/>allocated<sp/>disk<sp/>arrays<sp/>freed.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;DEBUG<sp/>[main]:<sp/>Program<sp/>exiting<sp/>normally.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="321"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/Users/tnehezd/Documents/Munka/dust_drift/src/main.c"/>
  </compounddef>
</doxygen>
